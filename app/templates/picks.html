<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Football Picks</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 20px; color:#111;}
    h1 { margin: 0 0 6px; font-size: 22px; }
    .summary { margin: 0 0 16px; color:#444; font-size: 14px; }
    form.filters { display: grid; grid-template-columns: repeat(5, minmax(120px, 1fr)) 120px; gap: 8px; margin: 16px 0; }
    input, select, button { padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 8px; }
    button { cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #eee; text-align: left; }
    th { position: sticky; top: 0; background: #fafafa; }
    .muted { color:#666; font-size: 12px; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; background:#f1f5f9; }
    .right { text-align:right; }
    .nowrap { white-space:nowrap; }
  </style>
</head>
<body>
  <h1>Football Picks</h1>
  {% if summary %}
    <div class="summary">
      fixtures: {{ summary.fixtures or 0 }},
      odds_rows: {{ summary.odds_rows or 0 }},
      model_rows: {{ summary.model_rows or 0 }},
      picks: {{ summary.picks or 0 }}
    </div>
  {% endif %}

  <form class="filters" method="get" action="/view">
    <select name="market" aria-label="Market">
      <option value="">All markets</option>
      <option value="1X2" {% if market_value=='1X2' %}selected{% endif %}>1X2</option>
      <option value="OU2.0" {% if market_value=='OU2.0' %}selected{% endif %}>OU 2.0</option>
      <option value="OU2.25" {% if market_value=='OU2.25' %}selected{% endif %}>OU 2.25</option>
      <option value="OU2.5" {% if market_value=='OU2.5' %}selected{% endif %}>OU 2.5</option>
      <option value="OU2.75" {% if market_value=='OU2.75' %}selected{% endif %}>OU 2.75</option>
      <option value="OU3.0" {% if market_value=='OU3.0' %}selected{% endif %}>OU 3.0</option>
      <option value="OU3.25" {% if market_value=='OU3.25' %}selected{% endif %}>OU 3.25</option>
      <option value="OU3.5" {% if market_value=='OU3.5' %}selected{% endif %}>OU 3.5</option>
      <option value="AH-0.5" {% if market_value=='AH-0.5' %}selected{% endif %}>AH -0.5</option>
      <option value="AH+0.5" {% if market_value=='AH+0.5' %}selected{% endif %}>AH +0.5</option>
    </select>

    <input type="text" name="league" placeholder="League (e.g., EPL, LaLiga)" value="{{ league_value or '' }}" />
    <input type="text" name="book" placeholder="Book (e.g., bet365)" value="{{ book_value or '' }}" />
    <input class="right" type="number" step="0.001" min="0" name="min_edge" placeholder="Min edge (0.05)" value="{{ min_edge_value }}" />
    <input class="right" type="number" step="0.001" min="0" max="1" name="min_prob" placeholder="Min prob (0.25)" value="{{ min_prob_value }}" />
    <button type="submit">Apply</button>
  </form>

  {% if rows and rows|length > 0 %}
    <table>
      <thead>
        <tr>
          <th class="nowrap">Kickoff (UTC)</th>
          <th>Match</th>
          <th>Market</th>
          <th>Selection</th>
          <th class="right">Price</th>
          <th>Book</th>
          <th class="right">Model&nbsp;Prob</th>
          <th class="right">Book&nbsp;Implied</th>
          <th class="right">Edge</th>
          <th class="right">Stake&nbsp;%</th>
          <th class="right">Stake</th>
          <th>League</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
          <tr>
            <td class="nowrap">{{ r.utc_kickoff or '' }}</td>
            <td>{{ r.match or (r.home ~ ' vs ' ~ r.away) }}</td>
            <td><span class="pill">{{ r.market }}</span></td>
            <td>{{ r.selection }}</td>
            <td class="right">{{ '%.2f'|format(r.price|float) if r.price is not none else '' }}</td>
            <td>{{ r.book }}</td>
            <td class="right">{{ '%.3f'|format(r.model_prob|float) if r.model_prob is not none else '' }}</td>
            <td class="right">{{ '%.3f'|format(r.implied|float) if r.implied is not none else '' }}</td>
            <td class="right">{{ '%.3f'|format(r.edge|float) if r.edge is not none else '' }}</td>
            <td class="right">{{ '%.2f'|format(r.stake_pct|float*100) if r.stake_pct is not none else '' }}%</td>
            <td class="right">{{ '%.2f'|format(r.stake_amt|float) if r.stake_amt is not none else '' }}</td>
            <td>{{ r.league }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="muted">No picks to show. Try running <code>/run</code> and then refresh this page, or lower your filters.</p>
  {% endif %}
</body>
</html>
